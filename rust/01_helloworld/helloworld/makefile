# Do not edit this file manually. This file is automatically generated by the init.sh script.

pwd := $(shell pwd)
VERSION := $(shell git describe --tags --always)

.PHONY: prom push build buildall checkmeta

# Rule to build a specific program or pass program name via variable
build:
	@if [ -z "$(program)" ]; then \
		echo "Error: No program specified. Usage: make build program=<program_name>"; \
		exit 1; \
	else \
		echo "Building program: $(program)"; \
		anchor keys sync; \
		anchor build --program-name $(program); \
		$(MAKE) checkmeta program=$(program); \
	fi

checkmeta:
	@if [ -z "$(program)" ]; then \
		echo "No program specified for checkmeta. Skipping metadata check."; \
	else \
		$(MAKE) _run_checkmeta; \
	fi

_run_checkmeta:
	@if [ "$$(uname)" = "Darwin" ] && [ "$$(uname -m)" = "x86_64" ]; then \
		./bin/checkmeta.macosx86 --program $(program); \
		owner_wallet=$${owner:-$(default_wallet)}; \
		./bin/checkdeploy.macosx86 --program $(program) --owner $$owner_wallet; \
	elif [ "$$(uname)" = "Linux" ]; then \
		./bin/checkmeta.ubuntu --program $(program); \
		owner_wallet=$${owner:-$(default_wallet)}; \
		./bin/checkdeploy.ubuntu --program $(program) --owner $$owner_wallet; \
	else \
		echo "checkmeta not executed, please check manually"; \
	fi

# Default wallet if none is specified
default_wallet := ~/.config/solana/id.json
